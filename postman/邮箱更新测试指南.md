# 邮箱更新测试指南

本文档提供了在测试用户邮箱更新功能时的特殊注意事项和最佳实践。

## 邮箱唯一性约束

在系统中，用户邮箱地址必须是唯一的。这意味着当尝试更新用户信息并修改邮箱地址时，必须确保新的邮箱地址在系统中尚未被使用。

## 已知问题

当尝试将用户邮箱更新为系统中已存在的邮箱时，后端会返回以下错误：

```
Error 1062 (23000): Duplicate entry '[邮箱地址]' for key 'users.uni_users_email'
```

这将导致API返回500内部服务器错误，而不是更友好的错误消息。

## 测试策略

为避免测试过程中遇到邮箱冲突问题，请采用以下策略：

1. **使用唯一邮箱命名模式**：
   - 用户ID附加到邮箱名称中: `user_[ID]@example.com`
   - 使用时间戳: `user_[timestamp]@example.com`

2. **推荐的测试邮箱模式**：
   - 管理员更新用户: `updated_user_[ID]@example.com`
   - 角色更新测试: `updated_admin_[ID]@example.com`
   - 普通用户自我更新: `updated_self_[ID]@example.com`

3. **确认邮箱可用**：
   - 在更新操作前，可以先获取所有用户列表，检查计划使用的邮箱是否已被占用

## 测试用例

1. **成功场景**：使用未被占用的新邮箱更新用户信息
   - 请求：`PUT /user/[ID]` 带有新的唯一邮箱
   - 预期：200 OK

2. **失败场景**：尝试使用已存在的邮箱
   - 请求：`PUT /user/[ID]` 带有系统中已存在的邮箱
   - 预期：当前为500错误，理想情况应为400错误带有明确消息

## 注意事项

- **避免使用登录账号的邮箱**：不要在测试中使用您当前登录的账号的邮箱来更新其他用户
- **记录已使用的邮箱**：在多人测试环境中，保持已使用邮箱的记录，避免冲突
- **定期清理测试账号**：在长期测试过程中，定期清理不再需要的测试账号可以减少邮箱冲突的可能性
